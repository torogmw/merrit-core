<html>
    <head>
        <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="vexflow-min.js"></script>
    </head>
    <body>
        <canvas width="700" height="200"></canvas>
        <script>
            function getParameter(name) {
                name = name.replace(/\[]/, "\\\[").replace(/[\]]/, "\\\]");
                var regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
                var results = regex.exec(window.location.search);
                if (results == null) return undefined;
                else return decodeURIComponent(results[1].replace(/\+/g, " "));
            }

            $(document).ready(function() {
                var param = getParameter("score");
                console.log(param)

                if (!param)
                    param = "b/5,8;g/4,8,#;b/4,8;e/5,8;b/4,8;g/4,8,#";

                staves_str = param.split(":");
                all_notes = [];
                all_beams = [];
                for (var i in staves_str) {
                    notes_str = staves_str[i].split(";");
                    notes = [];
                    for (var j in notes_str) {
                        fields = notes_str[j].split(",");
                        if (fields.length == 2) {
                            var note = new Vex.Flow.StaveNote({keys: [fields[0]], duration: fields[1]});
                            notes.push(note);
                        }
                        else if (fields.length == 3) {
                            var note = new Vex.Flow.StaveNote({keys: [fields[0]], duration: fields[1]}).addAccidental(0, new Vex.Flow.Accidental(fields[2]));
                            notes.push(note);
                        }
                    }
                    if (notes.length > 1) {
                        var beam = new Vex.Flow.Beam(notes);
                        all_beams.push(beam);
                    }
                    all_notes = all_notes.concat(notes);
                };

                var canvas = $("canvas")[0];
                var renderer = new Vex.Flow.Renderer(canvas, 
                    Vex.Flow.Renderer.Backends.CANVAS);

                var ctx = renderer.getContext();
                var stave = new Vex.Flow.Stave(10, 20, 500);

                // Add a treble clef
                stave.addClef("treble");
                stave.setContext(ctx).draw();

                console.log(all_notes);

                Vex.Flow.Formatter.FormatAndDraw(ctx, stave, all_notes);
                for (var i=0; i<all_beams.length; i++) {
                    all_beams[i].setContext(ctx).draw();
                }

            });
        </script>
    </body>
</html>